<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Scheduler</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=DM+Sans:wght@300;400;500;600;700&display=swap');
:root{
  --bg:#0c0a10;
  --bg2:#110d18;
  --surface:rgba(30,22,42,0.9);
  --surface2:rgba(40,30,55,0.8);
  --surface3:rgba(50,38,68,0.6);
  --border:rgba(212,168,83,0.12);
  --border2:rgba(212,168,83,0.25);
  --gold:#d4a853;
  --gold2:#f0c96a;
  --rose:#e8836a;
  --accent:var(--gold);
  --accent2:#60a5fa;
  --accent3:#4ade80;
  --accent4:#c084fc;
  --text:#f5f0e8;
  --text2:#c4b89a;
  --muted:#7c6e5a;
  --open:#4ade80;
  --busy:#fbbf24;
  --closed:#f87171;
  --grad:linear-gradient(135deg,#d4a853,#e8836a);
  --grad2:linear-gradient(135deg,#1e162a,#2d1f3d);
  --shadow:0 8px 32px rgba(0,0,0,0.4);
  --shadow-gold:0 4px 20px rgba(212,168,83,0.2);
  --glow:0 0 20px rgba(212,168,83,0.15);
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'DM Sans',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  background-image:
    radial-gradient(ellipse at 20% 0%,rgba(212,168,83,0.06) 0%,transparent 50%),
    radial-gradient(ellipse at 80% 100%,rgba(232,131,106,0.05) 0%,transparent 50%);
}
.page{padding:20px 20px 100px;max-width:1200px;margin:0 auto}
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:20px;
  padding:22px;
  margin-bottom:18px;
  backdrop-filter:blur(12px);
  box-shadow:var(--shadow);
  transition:border-color 0.3s;
}
.card:hover{border-color:var(--border2)}
.card-title{
  font-family:'Playfair Display',serif;
  font-size:15px;
  font-weight:700;
  margin-bottom:18px;
  color:var(--text);
  display:flex;
  align-items:center;
  gap:8px;
}
.card-title::after{content:'';flex:1;height:1px;background:var(--border);margin-left:8px}

/* BUTTONS */
.btn{padding:10px 22px;border-radius:12px;border:none;cursor:pointer;font-size:13px;font-weight:600;font-family:'DM Sans',sans-serif;transition:all 0.25s;letter-spacing:0.3px}
.btn-primary{background:var(--grad);color:#1a0f00;box-shadow:var(--shadow-gold)}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(212,168,83,0.35)}
.btn-primary:active{transform:translateY(0)}
.btn-secondary{background:var(--surface2);color:var(--text2);border:1px solid var(--border)}
.btn-secondary:hover{border-color:var(--border2);color:var(--text)}
.btn-danger{background:rgba(248,113,113,0.12);color:var(--closed);border:1px solid rgba(248,113,113,0.25)}
.btn-danger:hover{background:rgba(248,113,113,0.2)}
.btn-success{background:rgba(74,222,128,0.12);color:var(--open);border:1px solid rgba(74,222,128,0.25)}
.btn-success:hover{background:rgba(74,222,128,0.2)}
.btn-sm{padding:7px 14px;font-size:12px;border-radius:9px}

/* INPUTS */
.input{
  width:100%;
  padding:11px 16px;
  background:var(--surface2);
  border:1px solid var(--border);
  border-radius:12px;
  color:var(--text);
  font-size:13px;
  font-family:'DM Sans',sans-serif;
  outline:none;
  transition:all 0.2s;
}
.input:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(212,168,83,0.1)}
select.input{cursor:pointer}

/* TAGS */
.tag{display:inline-flex;align-items:center;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;letter-spacing:0.5px;text-transform:uppercase}
.tag-open,.tag-confirmed,.tag-instock{background:rgba(74,222,128,0.12);color:var(--open);border:1px solid rgba(74,222,128,0.2)}
.tag-busy,.tag-pending,.tag-low,.tag-seated{background:rgba(251,191,36,0.12);color:var(--busy);border:1px solid rgba(251,191,36,0.2)}
.tag-closed,.tag-cancelled,.tag-outofstock,.tag-absent{background:rgba(248,113,113,0.12);color:var(--closed);border:1px solid rgba(248,113,113,0.2)}
.tag-info,.tag-off{background:rgba(96,165,250,0.12);color:var(--accent2);border:1px solid rgba(96,165,250,0.2)}

/* TABLE */
table{width:100%;border-collapse:collapse}
th{font-size:10px;font-weight:700;color:var(--gold);text-transform:uppercase;letter-spacing:1.5px;padding:12px 14px;text-align:left;border-bottom:1px solid var(--border2)}
td{padding:13px 14px;font-size:13px;border-bottom:1px solid var(--border);vertical-align:middle;color:var(--text2)}
td:first-child{color:var(--text);font-weight:500}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(212,168,83,0.03);color:var(--text)}

/* STATS */
.stat-val{font-family:'Playfair Display',serif;font-size:28px;font-weight:800;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stat-label{font-size:11px;color:var(--muted);margin-top:6px;text-transform:uppercase;letter-spacing:1px;font-weight:600}

/* GRIDS */
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:18px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px}

/* MODAL */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(4px);z-index:500;align-items:center;justify-content:center}
.modal-bg.open{display:flex}
.modal{
  background:var(--bg2);
  border:1px solid var(--border2);
  border-radius:24px;
  padding:28px;
  width:90%;
  max-width:460px;
  max-height:90vh;
  overflow-y:auto;
  box-shadow:0 24px 60px rgba(0,0,0,0.6),var(--shadow-gold);
  animation:modalIn 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes modalIn{from{opacity:0;transform:scale(0.92) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-title{font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:20px;color:var(--text)}
.form-group{margin-bottom:16px}
.form-label{font-size:11px;color:var(--gold);margin-bottom:7px;display:block;font-weight:700;text-transform:uppercase;letter-spacing:0.8px}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:24px}

/* TOPBAR */
.topbar{
  position:sticky;top:0;
  display:flex;align-items:center;gap:14px;
  padding:14px 20px;
  background:rgba(12,10,16,0.85);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  z-index:100;
}
.burger-btn{background:none;border:none;color:var(--text2);font-size:20px;cursor:pointer;padding:6px;border-radius:8px;transition:all 0.2s}
.burger-btn:hover{color:var(--gold);background:rgba(212,168,83,0.1)}
.topbar-title{font-family:'Playfair Display',serif;font-weight:700;font-size:17px;flex:1;color:var(--text)}
.topbar-right{display:flex;align-items:center;gap:14px}
.topbar-clock{font-size:11px;color:var(--muted);font-weight:500}
.notif-badge{position:relative;cursor:pointer;font-size:18px;padding:4px}
.badge-count{position:absolute;top:-4px;right:-6px;background:var(--rose);color:white;font-size:9px;font-weight:700;width:16px;height:16px;border-radius:50%;display:flex;align-items:center;justify-content:center}

/* NAV DRAWER */
.nav-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.65);backdrop-filter:blur(2px);z-index:200}
.nav-overlay.open{display:block}
.nav-drawer{
  position:fixed;top:0;left:0;bottom:0;width:280px;
  background:linear-gradient(180deg,#0f0a18 0%,#150f22 100%);
  border-right:1px solid var(--border2);
  z-index:300;
  transform:translateX(-100%);
  transition:transform 0.35s cubic-bezier(0.4,0,0.2,1);
  display:flex;flex-direction:column;overflow-y:auto;
}
.nav-drawer.open{transform:translateX(0)}
.nav-header{padding:28px 20px 16px;position:relative}
.nav-logo{font-family:'Playfair Display',serif;font-weight:800;font-size:20px;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.nav-subtitle{font-size:11px;color:var(--muted);margin-top:3px;letter-spacing:0.5px}
.nav-email{font-size:11px;color:var(--text2);padding:0 20px 14px}
.nav-close{position:absolute;top:24px;right:16px;background:var(--surface2);border:1px solid var(--border);color:var(--muted);width:30px;height:30px;border-radius:8px;cursor:pointer;font-size:13px;transition:all 0.2s}
.nav-close:hover{color:var(--text);border-color:var(--border2)}
.nav-divider{height:1px;background:var(--border);margin:4px 0}
.nav-links{flex:1;padding:8px 12px}
.nav-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:12px;cursor:pointer;color:var(--muted);font-size:13px;font-weight:500;margin-bottom:2px;transition:all 0.2s}
.nav-item:hover{background:rgba(212,168,83,0.07);color:var(--text2)}
.nav-item.active{background:rgba(212,168,83,0.12);color:var(--gold);font-weight:600;border:1px solid rgba(212,168,83,0.15)}
.nav-icon{font-size:16px;width:22px;text-align:center}
.nav-active-dot{width:6px;height:6px;background:var(--gold);border-radius:50%;margin-left:auto;box-shadow:0 0 6px rgba(212,168,83,0.6)}
.nav-logout{padding:12px 20px 20px;color:var(--closed)!important;font-weight:500}

/* ANIMATIONS */
.fade-in{animation:fadeIn 0.4s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.stagger>*{animation:fadeIn 0.4s ease both}
.stagger>*:nth-child(1){animation-delay:0.05s}
.stagger>*:nth-child(2){animation-delay:0.1s}
.stagger>*:nth-child(3){animation-delay:0.15s}
.stagger>*:nth-child(4){animation-delay:0.2s}

/* MISC */
.loading{text-align:center;padding:48px;color:var(--muted);font-size:13px}
.loading::before{content:'‚ú¶';display:block;font-size:24px;margin-bottom:12px;animation:spin 2s linear infinite;color:var(--gold)}
@keyframes spin{to{transform:rotate(360deg)}}
.error-box{background:rgba(248,113,113,0.08);border:1px solid rgba(248,113,113,0.2);border-radius:12px;padding:16px;color:var(--closed);font-size:13px;margin-bottom:16px}
.empty-state{text-align:center;padding:60px 20px;color:var(--muted)}
.empty-state-icon{font-size:40px;margin-bottom:12px;opacity:0.5}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.section-title{font-family:'Playfair Display',serif;font-size:16px;font-weight:700;color:var(--text)}
.divider{height:1px;background:var(--border);margin:18px 0}
@media(max-width:768px){.grid-3,.grid-4{grid-template-columns:1fr 1fr}.grid-2{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="nav-overlay" id="navOverlay" onclick="closeNav()"></div>
<div class="nav-drawer" id="navDrawer">
  <div class="nav-header">
    <div class="nav-logo">‚ú¶ RestaurantOS</div>
    <div class="nav-subtitle">Admin Panel</div>
    <button class="nav-close" onclick="closeNav()">‚úï</button>
  </div>
  <div class="nav-email" id="navEmail"></div>
  <div class="nav-divider"></div>
  <nav class="nav-links" id="navLinks"></nav>
  <div class="nav-divider"></div>
  <div class="nav-item nav-logout" onclick="logout()"><span class="nav-icon">üö™</span><span>Logout</span></div>
</div>
<div class="topbar">
  <button class="burger-btn" onclick="openNav()">‚ò∞</button>
  <div class="topbar-title">Event Scheduler</div>
  <div class="topbar-right">
    <span class="topbar-clock" id="topClock"></span>
    <span class="notif-badge" onclick="go('notifications.html')">üîî<span class="badge-count" id="notifCount">0</span></span>
  </div>
</div>
<div class="page fade-in">

<div class="grid-4">
  <div class="card" style="text-align:center"><div class="stat-val" id="evTotal" style="color:var(--accent)">‚Äî</div><div class="stat-label">Total Events</div></div>
  <div class="card" style="text-align:center"><div class="stat-val" id="evConfirmed" style="color:var(--open)">‚Äî</div><div class="stat-label">Confirmed</div></div>
  <div class="card" style="text-align:center"><div class="stat-val" id="evPending" style="color:var(--busy)">‚Äî</div><div class="stat-label">Pending Deposit</div></div>
  <div class="card" style="text-align:center"><div class="stat-val" id="evGuests" style="color:var(--accent2)">‚Äî</div><div class="stat-label">Total Guests</div></div>
</div>
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px">
    <div class="card-title" style="margin:0">Event Schedule</div>
    <button class="btn btn-primary" onclick="openEvtModal()">+ New Event</button>
  </div>
  <div style="overflow-x:auto"><table>
    <thead><tr><th>Event</th><th>Type</th><th>Branch</th><th>Date &amp; Time</th><th>Guests</th><th>Package</th><th>Deposit</th><th>Status</th><th>Actions</th></tr></thead>
    <tbody id="evtBody"><tr><td colspan="9" class="loading">Loading...</td></tr></tbody>
  </table></div>
</div>
<div class="modal-bg" id="evtModal">
  <div class="modal">
    <div class="modal-title">New Event</div>
    <div class="form-group"><label class="form-label">Event Name / Host</label><input class="input" id="emName" placeholder="e.g. Santos Birthday Party"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div class="form-group"><label class="form-label">Type</label>
        <select class="input" id="emType"><option>Birthday</option><option>Anniversary</option><option>Corporate</option><option>Wedding Reception</option><option>Graduation</option><option>Other</option></select>
      </div>
      <div class="form-group"><label class="form-label">Branch</label><select class="input" id="emBranch"></select></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div class="form-group"><label class="form-label">Date</label><input class="input" id="emDate" type="date"></div>
      <div class="form-group"><label class="form-label">Time</label><input class="input" id="emTime" type="time"></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div class="form-group"><label class="form-label">Expected Guests</label><input class="input" id="emGuests" type="number"></div>
      <div class="form-group"><label class="form-label">Package</label>
        <select class="input" id="emPkg"><option>Basic</option><option>Standard</option><option>Premium</option><option>Exclusive</option></select>
      </div>
    </div>
    <div class="form-group"><label class="form-label">Deposit Paid (‚Ç±)</label><input class="input" id="emDeposit" type="number" value="0"></div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="document.getElementById('evtModal').classList.remove('open')">Cancel</button>
      <button class="btn btn-primary" onclick="saveEvt()">Save</button>
    </div>
  </div>
</div>

</div>

<script>
var API = 'https://railway-api-production-31fd.up.railway.app/';

function apiGet(ep){
  return fetch(API+ep).then(function(r){return r.json()}).catch(function(e){console.error(e);return null});
}
function apiPost(ep,data){
  return fetch(API+ep,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)}).then(function(r){return r.json()}).catch(function(e){console.error(e);return null});
}
function apiPut(ep,data){ return apiPost(ep,data); }
function apiDel(ep){
  return fetch(API+ep,{method:'DELETE'}).then(function(r){return r.json()}).catch(function(e){console.error(e);return null});
}).then(function(r){return r.json()}).catch(function(e){console.error(e);return null});
}
</script>

<script>

var NAV=[
  {id:'dashboard',   icon:'üè†',label:'Dashboard',          file:'dashboard.html'},
  {id:'reservations',icon:'üìÖ',label:'Reservations',        file:'reservations.html'},
  {id:'menu',        icon:'üçΩ',label:'Menu Management',     file:'menu.html'},
  {id:'inventory',   icon:'üì¶',label:'Inventory',           file:'inventory.html'},
  {id:'staff',       icon:'üë•',label:'Staff Management',    file:'staff.html'},
  {id:'billing',     icon:'üí∞',label:'Billing & Payments',  file:'billing.html'},
  {id:'events',      icon:'üóì',label:'Event Scheduler',     file:'events.html'},
  {id:'reports',     icon:'üìä',label:'Reports & Analytics', file:'reports.html'},
  {id:'feedback',    icon:'‚≠ê',label:'Customer Feedback',   file:'feedback.html'},
  {id:'notifications',icon:'üîî',label:'Notifications',      file:'notifications.html'},
  {id:'settings',    icon:'‚öôÔ∏è',label:'Settings',            file:'settings.html'},
];
function buildNav(activeId){
  document.getElementById('navEmail').textContent=localStorage.getItem('managerEmail')||'';
  var html='';
  for(var i=0;i<NAV.length;i++){
    var n=NAV[i];
    var a=n.id===activeId;
    html+='<div class="nav-item'+(a?' active':'')+'" onclick="go(\''+n.file+'\')"><span class="nav-icon">'+n.icon+'</span><span>'+n.label+'</span>'+(a?'<span class="nav-active-dot"></span>':'')+'</div>';
  }
  document.getElementById('navLinks').innerHTML=html;
}
function openNav(){document.getElementById('navDrawer').classList.add('open');document.getElementById('navOverlay').classList.add('open')}
function closeNav(){document.getElementById('navDrawer').classList.remove('open');document.getElementById('navOverlay').classList.remove('open')}
function go(f){window.location.href=f}
function logout(){sessionStorage.clear();window.location.href='pin-login.html'}
function initClock(){
  (function tick(){
    var el=document.getElementById('topClock');
    if(el)el.textContent=new Date().toLocaleString('en-PH',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});
    setTimeout(tick,1000);
  })();
}
function authGuard(){
  if(localStorage.getItem('isLoggedIn')!=='true')window.location.href='index.html';
  if(sessionStorage.getItem('pinVerified')!=='true')window.location.href='pin-login.html';
}
function loadNotifCount(){
  apiGet('notifications.php').then(function(data){
    if(!data)return;
    var unread=data.filter(function(n){return n.is_read==='0'||n.is_read===0}).length;
    var el=document.getElementById('notifCount');
    if(el)el.textContent=unread;
  });
}

authGuard();
buildNav('events');
initClock();
loadNotifCount();

var evtEmoji={Birthday:'üéÇ',Anniversary:'üíë',Corporate:'üè¢','Wedding Reception':'üíí',Graduation:'üéì',Other:'üéâ'};

function loadEvents(){
  apiGet('branches.php').then(function(data){
    if(!data)return;
    var h='';
    for(var i=0;i<data.length;i++)h+='<option value="'+data[i].id+'">'+data[i].name+'</option>';
    document.getElementById('emBranch').innerHTML=h;
  });
  apiGet('events.php').then(function(data){
    if(!data){document.getElementById('evtBody').innerHTML='<tr><td colspan="9" class="loading">Failed to load</td></tr>';return;}
    document.getElementById('evTotal').textContent=data.length;
    document.getElementById('evConfirmed').textContent=data.filter(function(e){return e.status==='Confirmed'}).length;
    document.getElementById('evPending').textContent=data.filter(function(e){return e.status==='Pending Deposit'}).length;
    document.getElementById('evGuests').textContent=data.reduce(function(s,e){return s+parseInt(e.guests)},0);
    var html='';
    for(var i=0;i<data.length;i++){
      var e=data[i];
      var t=e.event_time?e.event_time.slice(0,5):'';
      var tagC=e.status==='Confirmed'?'tag-open':'tag-busy';
      html+='<tr>'
        +'<td><strong>'+(evtEmoji[e.event_type]||'üéâ')+' '+e.event_name+'</strong></td>'
        +'<td>'+e.event_type+'</td>'
        +'<td>'+(e.branch_name||'‚Äî')+'</td>'
        +'<td>'+e.event_date+'<br><span style="font-size:11px;color:var(--muted)">'+t+'</span></td>'
        +'<td style="text-align:center">'+e.guests+'</td>'
        +'<td style="font-size:12px">'+e.package+'</td>'
        +'<td style="font-weight:700;color:'+(parseFloat(e.deposit)>0?'var(--open)':'var(--closed)')+'">&#8369;'+parseFloat(e.deposit).toLocaleString()+'</td>'
        +'<td><span class="tag '+tagC+'">'+e.status+'</span></td>'
        +'<td><button class="btn btn-danger" style="padding:5px 10px;font-size:11px" onclick="delEvt('+e.id+')">Del</button></td>'
        +'</tr>';
    }
    document.getElementById('evtBody').innerHTML=html;
  });
}

function openEvtModal(){
  document.getElementById('emName').value='';
  document.getElementById('emGuests').value='';
  document.getElementById('emDeposit').value='0';
  document.getElementById('emDate').value=new Date().toISOString().split('T')[0];
  document.getElementById('evtModal').classList.add('open');
}

function saveEvt(){
  var name=document.getElementById('emName').value.trim();
  if(!name){alert('Enter event name');return;}
  var data={event_name:name,event_type:document.getElementById('emType').value,branch_id:document.getElementById('emBranch').value,event_date:document.getElementById('emDate').value,event_time:document.getElementById('emTime').value,guests:document.getElementById('emGuests').value||0,package:document.getElementById('emPkg').value,deposit:document.getElementById('emDeposit').value||0,status:'Pending Deposit'};
  apiPost('events.php',data).then(function(res){
    if(res&&res.success){document.getElementById('evtModal').classList.remove('open');loadEvents();}
    else alert('Failed to save.');
  });
}

function delEvt(id){
  if(!confirm('Delete this event?'))return;
  apiDel('events.php?id='+id).then(function(){loadEvents()});
}

loadEvents();

</script>
</body>
</html>